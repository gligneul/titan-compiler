#!/usr/bin/env lua

local argparse = require 'argparse'

local parser = require 'titan-compiler.parser'
local util = require 'titan-compiler.util'

local p = argparse('titan', 'Titan compiler')
p:argument('input', 'Input file.')
p:flag('--print-ast', 'Print the AST.')
local args = p:parse()

-- Work like assert, but don't print the stack trace
local function check(value, msg)
    if not value then
        print(arg[0] .. ": " .. msg)
        os.exit(1)
    else
        return value
    end
end

local input
if args.input == '-' then
    input = io.read("*a")
else
    input = check(util.get_file_contents(args.input))
end
local ast = check(parser.parse(input))
if args.print_ast then
    print(parser.pretty_print_ast(ast))
end

